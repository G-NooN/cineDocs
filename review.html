<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>리뷰 작성</title>
    <link rel="stylesheet" href="./style/review.css" />
    <link rel="stylesheet" href="./style/reset.css" />
    <script type="module" src="./src/main.js"></script>
  </head>
  <body>
    <div class="review-box">
      <form id="comment-form">
        <div class="user-info">
          <input type="text" id="username" placeholder="이름" required />
          <input type="password" id="user-password" placeholder="비밀번호" required />
        </div>
        <div class="comment-area">
          <textarea id="comment" placeholder="리뷰를 입력하세요." required></textarea>
          <button type="button" id="submit-btn" onclick="saveComment()">등록</button>
        </div>
      </form>
      <div id="comment-list"></div>
    </div>
  </body>
  <script>
    function saveComment() {
      const name = document.querySelector("#username").value;
      const password = document.querySelector("#user-password").value;
      const commentText = document.querySelector("#comment").value;
      //saveComment()는 리뷰 등록 버튼의 onclick에 들어가 있는 함수이다. 리뷰를 써서 작성된 텍스트 값들을 각각 변수에 할당해 주었다.

      const comment = {
        name,
        password,
        commentText,
      }; //comment라는 변수에 name, password, commentText라는 객체를 할당해주었다.

      const commentsList = JSON.parse(localStorage.getItem("comment-list")) || []; //JSON.parse()의 반환값이 null또는 undefined인 경우를 처리한다.

      commentsList.unshift(comment);
      //새로운 댓글을 리스트에 추가함. push 대신 unshift를 사용하여 최근 댓글이 가장 위로 오게함. push를 사용하면 최근 댓글이 가장 아래로 배치된다.
      localStorage.setItem("comment-list", JSON.stringify(commentsList)); //업데이트 된 리뷰 목록. comments에 추가된 값을 JSON 문자열화해서 commentsList에 넣어 localStorage에 저장한다.

      displayComments();
    }

    function displayComments() {
      const commentBox = document.querySelector("#comment-list");
      commentBox.innerHTML = ""; // comments의 내용이 들어갈 commentBox 변수 값을 설정해주었다.

      const commentList = JSON.parse(localStorage.getItem("comment-list")) || []; //localStorage에 comments라는 키로 저장된 데이터가 있으면 해당 데이터를 JSON 형식으로 파싱하여 반환한다. localStorage에 comments라는 키로 저장된 데이터가 없으면 빈 배열을 반환한다.

      commentList.forEach((comment) => {
        const newComment = document.createElement("div");
        newComment.className = "comment-item";
        newComment.innerHTML = `
        <div class="comment-box">
          <div class="comment-data">
            <p class="comment-name">${comment.name}</p>
            <p class="comment-contents">${comment.commentText}</p>
          </div>
          <div class="control-btn">
            <button onclick="editComment()" id="editCommentBtn">수정</button>
            <button onclick="deleteComment()" id="deleteCommentBtn">삭제</button>
          </div>
        </div>`; //commentList에 comment의 내용들을 순회하며 갖다 붙인다. 새로운 div요소를 만들고, newComment의 골격을 만들었다. 화면에 표시될 댓글에는 입력한 이름, 리뷰 내용이 들어가고, 수정 버튼과 삭제 버튼도 들어가게 된다.
        //editCommentBtn와 deleteCommentBtn에 index를 추가하여 특정 댓글을 삭제하게끔 해야한다.

        commentBox.appendChild(newComment); //newComment가 commentBox에 자식 포지션으로 들어가게 된다.
      });
    }

    displayComments();

    window.localStorage.clear(); //작성되어 화면에 포스팅된 리뷰를 전체 삭제. 삭제버튼이 구현되면 삭제할 예정
  </script>
</html>
